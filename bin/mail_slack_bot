#!/usr/bin/env ruby

require 'mail_slack_bot'
require 'optparse'

op = OptionParser.new
op.version = MailSlackBot::VERSION

opts = {}

op.on('-s', "--setup [DIR=./conf/]", "install sample configuration file to the directory") {|s|
  opts[:setup_path] = s || "conf"
}

op.on('-c', '--config PATH', "config file path") {|s|
  opts[:config_path] = s
}

op.parse!(ARGV)

if setup_path = opts[:setup_path]
  require 'fileutils'
  FileUtils.mkdir_p setup_path
  confpath = File.join(setup_path, "mail_slack_bot.conf")
  if File.exist?(confpath)
    puts "#{confpath} already exists."
  else
    File.open(confpath, "w") {|f|
      conf = File.read File.join(File.dirname(__FILE__), "..", "mail_slack_bot.conf")
      f.write conf
    }
    puts "Installed #{confpath}."
  end
  exit 0
end

daemon = MailSlackBot::Daemon.new(opts)
daemon.run
